{"version":3,"sources":["dist/zxdom.js"],"names":["global","factory","exports","module","define","amd","zxdom","this","setAttr","el","name","oldval","val","substr","removeAttribute","setAttribute","updateAttr","oldAttr","newAttr","Object","keys","forEach","make","vnode","svg","component","inst","instances","push","tag","attr","chld","oncreate","document","createElementNS","createElement","c","appendChild","text","createTextNode","replace","oldnode","newel","parent","parentNode","callOnRemove","replaceChild","chel","childNodes","onremove","chnode","i","getIndexOfVNode","vnodes","keyOrTag","start","length","node","key","getKeyOrTagOfVNode","setComponentInstance","newnode","index","indexOf","splice","patch","parentEl","oldChildren","newChildren","n","chels","o","insertBefore","removeChild","updateChildren","onupdate","h","type","concat","func","assign","state","initial","update","mount","defineProperty","value"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (factory((global.zxdom = {})));\n}(this, (function (exports) { 'use strict';\n\n    function setAttr(el, name, oldval, val) {\n        if (name === 'key' || name === 'value' || name === 'selected' || name === 'checked' || name.substr(0,2) === 'on') {\n            el[name] = val;\n        } else if (val == null) {\n            el.removeAttribute(name);\n        } else if (oldval !== val) {\n            el.setAttribute(name, val);\n        }\n    }\n    //need a test: seems not to matter what we pass as third arg in first loop below\n    //also need a test for checked\n    function updateAttr (el, oldAttr, newAttr) {\n        Object.keys(oldAttr).forEach(name => {\n            if (newAttr[name] == null) setAttr(el, name, el);\n        });\n        Object.keys(newAttr).forEach(name => {\n            setAttr(el, name, oldAttr[name], newAttr[name]);\n        });\n        return el\n    }\n\n    function makeHTMLElement ({tag, attr, chld}, svg = false) {\n        const oncreate = attr.oncreate;\n        svg = svg || (tag === 'svg');\n        const el = svg ? document.createElementNS('http://www.w3.org/2000/svg', tag) : document.createElement(tag);\n        updateAttr(el, {}, attr);\n        chld.forEach(c => el.appendChild(make(c, svg)));\n        if (oncreate) {\n            oncreate(el);\n        }\n        return el\n    }\n\n    function makeTextNode (text) {\n        return document.createTextNode(text)\n    }\n\n    function makeComponentInstance (inst) {\n        inst.el = make(inst.vnode);\n        inst.component.instances.push(inst);\n        return inst.el\n    }\n\n    function make (vnode, svg) {\n        return (\n            vnode.component ? makeComponentInstance\n            : vnode.tag ? makeHTMLElement\n            : makeTextNode\n        )(vnode, svg)\n    }\n\n    function replace(el, vnode, oldnode) {\n        const newel = make(vnode);\n        const parent = el.parentNode;\n        if (parent) {\n            callOnRemove(el, oldnode);\n            parent.replaceChild(newel, el);\n        }\n        return newel\n    }\n\n    function callOnRemove(el, oldnode) {\n        let {attr, chld} = oldnode;\n        let chel = el.childNodes;\n        if (attr && attr.onremove) attr.onremove(el);\n        if (chld) chld.forEach((chnode, i) => callOnRemove(chel[i], chnode));\n    } \n\n    function getIndexOfVNode(vnodes, keyOrTag, start = 0) {\n        for (let i = start; i < vnodes.length; i++) {\n            let node = vnodes[i];\n            if (node.attr && node.attr.key) {\n                if (node.attr.key === keyOrTag) return i\n                continue\n            } else if (node.tag === keyOrTag) {\n                return i\n            }\n        }\n    }\n\n    function getKeyOrTagOfVNode(vnode) {\n        if (vnode.attr && vnode.attr.key) return vnode.attr.key\n        return vnode.tag\n    }\n\n    function updateChildren(parentEl, oldChildren = [], newChildren = []) {\n        let n = 0;\n        const chels = parentEl.childNodes;\n        while (n < oldChildren.length && n < newChildren.length) {\n            let o = getIndexOfVNode(oldChildren, getKeyOrTagOfVNode(newChildren[n]), n);\n            if (o == null) {\n                parentEl.insertBefore(make(newChildren[n]), chels[n]);\n                oldChildren.splice(n, 0, null);\n            } else {\n                if (o != n) {\n                    parentEl.insertBefore(chels[o], chels[n]);\n                    oldChildren.splice(n, 0, oldChildren.splice(o, 1)[0]); //corresponding move in oldchildren\n                }\n                patch(chels[n], oldChildren[n], newChildren[n]);\n            }\n            n++;\n        }\n        while (n < oldChildren.length) {\n            let el = chels[n];\n            callOnRemove(el, oldChildren[n]);\n            parentEl.removeChild(el);\n            oldChildren.splice(n, 1);\n        }\n        while (n < newChildren.length) {\n            parentEl.appendChild(make(newChildren[n++]));\n        }\n    }\n\n    function setComponentInstance(oldnode, newnode) {\n        const instances = oldnode.component.instances;\n        const index = instances.indexOf(oldnode);\n        if (newnode) instances.splice(index, 1, newnode);\n        else instances.splice(index, 1);\n    }\n\n    function patch (el, oldnode, newnode) {\n        if (oldnode.component) {\n            if ( oldnode.component === newnode.component ) {\n                setComponentInstance(oldnode, newnode);\n                el = patch(el, oldnode.vnode, newnode.vnode);\n                newnode.el = el;\n            } else {\n                setComponentInstance(oldnode); //remove the old component instance\n                el = replace(el, newnode.vnode, oldnode.vnode);\n            }\n        } else if (oldnode.tag) {\n            if (getKeyOrTagOfVNode(oldnode) === getKeyOrTagOfVNode(newnode)) {\n                updateAttr(el, oldnode.attr, newnode.attr);\n                updateChildren(el, oldnode.chld, newnode.chld);\n                if (newnode.attr && newnode.attr.onupdate) {\n                    newnode.attr.onupdate(el);\n                }\n            } else {\n                el = replace(el, newnode, oldnode);\n            }\n        } else if (oldnode !== newnode) {\n            el = replace(el, newnode, oldnode);\n        }\n        return el\n    }\n\n    function h(type, attr, ...chld) {\n        attr = attr || {};\n        chld = [].concat(...[].concat(...chld)); //flatten children into a single array\n        if (!!type.func) return {\n            component: type,\n            vnode: type.func(Object.assign({}, attr, type.state), chld),\n            attr,\n            chld,\n        }\n        if (typeof type === 'function') return type(attr, chld)\n        return {tag: type, attr, chld}\n    }\n\n    function define (func, initial = {}) {\n        return {\n            func,\n            state: initial,\n            instances: []\n        }\n    }\n\n    function update (component, state={}) {\n        component.state = state;\n        component.instances.forEach(inst => {\n            patch(inst.el, inst, h(component, Object.assign({}, inst.attr), inst.chld));\n        });    \n    }\n\n    function mount (vnode, parent) {\n        if (vnode.func) vnode = h(vnode);\n        parent.appendChild(make(vnode));\n    }\n\n    exports.patch = patch;\n    exports.make = make;\n    exports.h = h;\n    exports.define = define;\n    exports.update = update;\n    exports.mount = mount;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=zxdom.js.map\n"]}